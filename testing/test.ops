loadService("Deployer", "print")
kickStart("helloworld_yarp.xml")

program test {
	var string s
	print.log(Info, "*** Starting Yarp test ***")
	yield
	
	Hello.the_results.write("Hello World")
	print.log(Info, "Hello has written \"Hello World\"")
	yield
	
	if (World.the_buffer_port.read(s) == NewData && s == "Hello World") then 
		print.log(Info, "World has received \"Hello World\"")
	else error
	yield

	Hello.the_results.write("Hello")
	print.log(Info, "Hello has written \"Hello\"")
	yield
	
	Hello.the_results.write("World")
	print.log(Info, "Hello has written \"World\"")
	yield
	
	Hello.the_results.write("Hello World")
	print.log(Info, "Hello has written \"Hello World\"")
	yield

	if (World.the_buffer_port.read(s) == NewData && s == "Hello") then 
		print.log(Info, "World has received \"Hello\"")
	else error
	yield
	
	if (World.the_buffer_port.read(s) == NewData && s == "World") then 
		print.log(Info, "World has received \"World\"")
	else error
	yield
	
	if (World.the_buffer_port.read(s) == OldData) then
		print.log(Info, "World buffer has no more new data -- buffer size is 2")
	else error
	yield
	
	print.log(Info, "*** Test Successful ***")
}

test.start()
